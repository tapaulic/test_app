function getFormValues(e){var t=$(e).serializeArray(),a=[];return $.each(t,function(e,t){JSON.stringify(t).indexOf("[template]")<0&&a.push(t)}),a}function CotForm(e){if(!e)throw new Error("You must supply a form definition");this._isRendered=!1,this._definition=e,this._useBinding=e.useBinding||!1,this._model=null,this.cotForm=new cot_form({id:e.id||"new_form",title:e.title,rootPath:e.rootPath,success:e.success||function(){}});var t=this,a=["text","dropdown","textarea","checkbox","radio","password","multiselect"];$.each(e.sections||[],function(e,i){var r=t.cotForm.addSection({id:i.id||"section"+e,title:i.title,className:i.className});$.each(i.rows||[],function(e,t){t.fields?(t.fields.forEach(function(e){var t=e.type||"text";if(e.bindTo&&a.indexOf(t)===-1)throw new Error("Error in field "+(e.id||"no id")+", fields of type "+t+" cannot use bindTo.")}),r.addRow(t.fields)):t.grid&&r.addGrid(t.grid)})})}var browser=navigator.userAgent,IEversion=99;IEversion=browser.indexOf("MSIE")>1?parseInt(browser.substr(browser.indexOf("MSIE")+5,5)):IEversion;var cot_form=function(e){this.id=e.id,this.title=e.title,this.success=e.success,this.rootPath=e.rootPath,this.sections=[]};cot_form.addDefaultFieldProperties=function(e){return cot_form.fixClassProperty(e),(e||[]).forEach(function(e){if(e.type=e.type||"text",e.id=e.id||Math.random().toString().split(".")[1],"html button static".indexOf(e.type)!==-1||e.title||console.warn("Missing title attribute for field "+e.id),["radio","checkbox","dropdown","multiselect"].indexOf(e.type)>-1&&!$.isArray(e.choices))throw new Error("Error in field "+e.id+": choices property is missing or invalid");"datetimepicker"===e.type&&(e.options=$.extend({format:"MM/DD/YYYY"},e.options)),"daterangepicker"===e.type&&(e.options=$.extend({locale:{format:"MM/DD/YYYY",separator:" - "}},e.options))}),e},cot_form.fixClassProperty=function(e){$.each($.makeArray(e||[]),function(e,t){void 0===t.className&&"string"==typeof t.class&&(t.className=t.class,delete t.class)})};var cot_section=function(e){cot_form.fixClassProperty(e),this.id=e.id,this.title=e.title,this.className=e.className,this.rows=[]},cot_row=function(e){this.fields=cot_form.addDefaultFieldProperties(e),this.type="standard"},cot_grid=function(e){cot_form.fixClassProperty(e),this.id=e.id?e.id:"grid-"+Math.floor(1e8*Math.random()),this.add=!!e.add,this.className=e.className,this.title=e.title,this.headers=e.headers,this.fields=cot_form.addDefaultFieldProperties(e.fields),this.type="grid"};cot_form.prototype.addSection=function(e){return e instanceof cot_section||(e=new cot_section(e)),this.sections.push(e),e},cot_section.prototype.addRow=function(e){return e instanceof cot_row||(e=new cot_row(e)),this.rows.push(e),this},cot_section.prototype.addGrid=function(e){return e instanceof cot_grid||(e=new cot_grid(e)),this.rows.push(e),this},cot_form.prototype.render=function(e){var t=this,a={fields:{}},i=document.createElement("form");if(i.id=this.id,i.className="cot-form",i.setAttribute("data-fv-framework","bootstrap"),i.setAttribute("data-fv-icon-valid","glyphicon glyphicon-ok"),i.setAttribute("data-fv-icon-invalid","glyphicon glyphicon-remove"),i.setAttribute("data-fv-icon-validating","glyphicon glyphicon-refresh"),this.title){i.appendChild(document.createElement("h2")).textContent=this.title}$.each(this.sections,function(e,r){var n=i.appendChild(document.createElement("div"));if(n.id=r.id,n.className=void 0!==r.className?"panel "+r.className:"panel panel-default",r.title){var d=n.appendChild(document.createElement("div"));d.className="panel-heading";var o=d.appendChild(document.createElement("h3"));o.appendChild(document.createElement("span")).className="glyphicon glyphicon-th-large",o.appendChild(document.createElement("span")),o.textContent=r.title}var l=n.appendChild(document.createElement("div"));l.className="panel-body",$.each(r.rows,function(e,i){var r=l.appendChild(document.createElement("div"));r.className="row","grid"==i.type?t.processGrid(r,a,i):$.each(i.fields,function(e,n){t.processField(r,a,i,n)})})}),$(e.target).append(i),$.each(this.sections,function(e,a){$.each(a.rows,function(e,a){t.initializePluginsInRow(a)})});var r=$("#"+this.id),n=$.extend({excluded:[":not(.multiselect):disabled",":not(.multiselect):hidden",":not(.multiselect):not(:visible)"],feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},onSuccess:this.success,onError:function(e){console.log("Validation error occurred:",e),$($(".has-error input, .has-error select, .has-error button")[0]).focus()},fields:a.fields},e.formValidationSettings||{});r.formValidation(n).on("err.field.fv",function(e){$(e.target).closest(".form-group").find("input,select,textarea").attr("aria-invalid",!0)}).on("success.field.fv",function(e,t){$(e.target).closest(".form-group").find("input,select,textarea").attr("aria-invalid",!1)}),r.find("button.fv-hidden-submit").text("hidden submit button"),r.find("button.fv-hidden-submit").attr("aria-hidden",!0),t.fixFormValidationRender(r)},cot_form.prototype.fixFormValidationRender=function(e){e.find("i.form-control-feedback").attr("aria-hidden","true"),e.find("label.radioLabel>i, label.checkboxLabel>i").each(function(){var e=$(this);e.insertAfter(e.closest("fieldset").find("legend"))}),e.find("div.datetimepicker").each(function(){var e=$(this);e.parent().find("i.form-control-feedback").insertAfter(e.find("input"))})},cot_form.prototype.initializePluginsInRow=function(e,t){t||(t=$("#"+this.id));var a=this;$.each(e.fields,function(e,i){switch(i.type){case"multiselect":var r=t.find("."+i.id+".multiselect");(window.cot_app||window.CotApp).addMultiselect({$select:r,ariaLabelledBy:r.attr("aria-labelledby"),ariaDescribedBy:r.attr("aria-describedby"),ariaRequired:r.attr("aria-required"),multiselectOptions:i.options});break;case"daterangepicker":t.find(".daterangevalidation").daterangepicker(i.options).on("show.daterangepicker",function(e,t){$($(t)[0]).focus()}),$(".daterangepicker").attr("aria-hidden",!0);break;case"datetimepicker":t.find("."+i.id+".datetimepicker").datetimepicker(i.options).on("dp.change",function(){var e=$(this).attr("data-refid");$("#"+a.id).data("formValidation").updateStatus(e,"NOT_VALIDATED").validateField(e)});break;default:if("Phone"===i.validationtype&&IEversion>=10){if("string"!=typeof a.rootPath)throw new Error("rootPath must be defined for cot form when using Phone fields");t.find(".phonevalidation").intlTelInput({utilsScript:a.rootPath+"js/utils.js",autoPlaceholder:!1,preferredCountries:["ca"]}),t.find(".flag-dropdown").attr("aria-hidden",!0)}}}),t.find('[data-toggle="tooltip"]').tooltip({html:!0})},cot_form.prototype.processGrid=function(e,t,a){var i,r=this,n=e.appendChild(document.createElement("div"));n.id=a.id,n.className="grid-object table-responsive ",n.className+=a.className||"",n.className+=a.addclass?" "+a.addclass:"",r[n.id+"-index"]=0;var d=n.appendChild(document.createElement("h4"));d.className="grid-title",d.textContent=a.title;var o=n.appendChild(document.createElement("table"));o.className="grid-table table table-striped";var l=o.appendChild(document.createElement("tr"));$.each(a.headers,function(e,t){var i=l.appendChild(document.createElement("th"));i.textContent=t.title,i.id=a.id+"_header_"+e}),oTH=l.appendChild(document.createElement("th"));var s=oTH.appendChild(document.createElement("span"));s.className="sr-only",s.textContent="Add/Remove Rows",l=o.appendChild(document.createElement("tr")),l.id=a.id+"-row-0",l.setAttribute("data-row-index","0");var c={};$.each(a.fields,function(e,i){var n=l.appendChild(document.createElement("td"));if(n.className="form-group",n.className+=i.addclass?" "+i.addclass:"",i.grid="0",i.gridlabel=a.id+"_header_"+e,0===e){var d=n.appendChild(document.createElement("span"));d.className="sr-only",d.id="row_sr_label_0",d.textContent=a.title+" row 1"}r.addformfield(i,n);var o=i.id;i.id="row[0]."+i.id,r.addfieldvalidation(t,i,n),i.id=o,c[i.id]=i});var p=l.appendChild(document.createElement("td"));p.className="text-right",i=p.appendChild(document.createElement("button")),i.className="btn btn-default grid-minus",i.type="button",i.disabled=!0,i.title="Remove this row from "+a.title,i.appendChild(document.createElement("span")).className="glyphicon glyphicon-minus";var s=i.appendChild(document.createElement("span"));s.className="sr-only",s.textContent="Remove Row",l=o.appendChild(document.createElement("tr")),l.id=n.id+"-template",l.className="hide",$.each(a.fields,function(e,t){var i=l.appendChild(document.createElement("td"));if(i.className="form-group",i.className+=t.addclass?" "+t.addclass:"",t.grid="template",0===e){var n=i.appendChild(document.createElement("span"));n.className="sr-only",n.id="row_sr_label_template",n.textContent=a.title+", row template"}r.addformfield(t,i)}),p=l.appendChild(document.createElement("td")),p.className="text-right",i=p.appendChild(document.createElement("button")),i.type="button",i.className="btn btn-default grid-minus",i.title="Remove this row from "+a.title,s=i.appendChild(document.createElement("span")),s.className="glyphicon glyphicon-minus",s=s.appendChild(document.createElement("span")),s.className="sr-only",s.textContent="Remove Row",l=o.appendChild(document.createElement("tr")),p=l.appendChild(document.createElement("td")),p.colSpan=a.fields.length+1,i=p.appendChild(document.createElement("button")),i.className="btn btn-default pull-right grid-add",i.type="button",i.onclick=function(){r[n.id+"-index"]++;var e=r[n.id+"-index"],t=$("#"+n.id+"-template"),i=t.clone().removeClass("hide").attr("id",n.id+"-row-"+e).attr("data-row-index",e),d=i.html();d=d.replace(/, row template/g,", row "+(parseInt(e)+1)),d=d.replace(/template/g,e),i.html(d),i.insertBefore(t),i.find(".grid-minus").click(function(){var e=$(this).closest("tr");$.each(e.find(".form-control"),function(e,t){var a=$(t),i="FIELDSET"===t.tagName.toUpperCase()?a.find("input").first().attr("name"):a.attr("name");$("#"+r.id).formValidation("removeField",i)});var t=e.prev().find("input,select,textarea").first();e.remove(),t.focus()});var o=i.find(".form-control");$.each(o,function(t,a){var i=$(a),n="FIELDSET"===a.tagName.toUpperCase()?i.find("input").first().attr("name"):i.attr("name"),d=c[n.split(".")[1]],o=r.validatorOptions(d);r.addValidatorMessageDiv(d,o,i.closest("td")[0],e),$("#"+r.id).formValidation("addField",n,o)}),r.initializePluginsInRow(a,i),r.fixFormValidationRender(i),i.find("input,select,textarea").first().focus()},i.appendChild(document.createElement("span")).className="glyphicon glyphicon-plus";var s=i.appendChild(document.createElement("span"));s.textContent="Add Row to "+a.title},cot_form.prototype.processField=function(e,t,a,i){var r=a.fields.length,n=e.appendChild(document.createElement("div"));n.id=i.id+"Element",n.className=i.className||(1==r?"col-xs-12":2==r?"col-xs-12 col-sm-6":3==r?"col-xs-12 col-md-4":"col-xs-12 col-sm-6 col-md-3"),n.className+=" form-group form-group-",n.className+=i.orientation||"vertical",n.className+=i.addclass?" "+i.addclass:"";var d=n.appendChild(document.createElement("div"));if(["html","button"].indexOf(i.type)==-1){var o=["static","checkbox","radio"].indexOf(i.type)===-1;if(o||i.title){var l=d.appendChild(document.createElement(o?"label":"span"));l.className=o?"control-label":"staticlabel"+("static"!=i.type?" "+i.type:""),o&&(l.htmlFor=i.id);if(l.appendChild(document.createElement("span")).textContent=i.title,!i.required&&"static"!=i.type){var s=l.appendChild(document.createElement("span"));s.className="optional",s.textContent="(optional)"}if(i.infohelp){var c=l.appendChild(document.createElement("span"));c.className="glyphicon glyphicon-info-sign",c.setAttribute("data-toggle","tooltip"),c.setAttribute("data-placement","top"),c.tabIndex=0,c.title=i.infohelp}}}this.addprehelptext(i,d),this.addformfield(i,d),this.addposthelptext(i,d),this.addfieldvalidation(t,i,d)},cot_form.prototype.addprehelptext=function(e,t){if(e.prehelptext){var a=t.appendChild(document.createElement("p"));a.className="helptext",a.id="prehelptext_"+e.id,a.innerHTML=e.prehelptext}},cot_form.prototype.addformfield=function(e,t){t.appendChild(this.callFunction(this[e.type+"FieldRender"],e,t)),e.prehelptext&&this.updateDescribedBy(t,"prehelptext_"+e.id)},cot_form.prototype.addposthelptext=function(e,t){if(e.posthelptext){var a=t.appendChild(document.createElement("p"));a.className="helptext",a.id="posthelptext_"+e.id,a.innerHTML=e.posthelptext,this.updateDescribedBy(t,a.id)}},cot_form.prototype.validatorOptions=function(e){var t={};if(e.required&&(t.notEmpty={message:e.requiredMessage||e.title+" is required and cannot be left blank"}),"datetimepicker"===e.type)t.callback={message:e.validationMessage||"The date must be in the format "+e.options.format,callback:function(t){return""===t&&!e.required||moment(t,e.options.format,!0).isValid()}};else if("daterangepicker"===e.type)t.callback={message:e.validationMessage||"The dates must be in the format "+e.options.locale.format+e.options.locale.separator+e.options.locale.format,callback:function(t){var a=t.split(e.options.locale.separator);return""===t&&!e.required||2===a.length&&moment(a[0],e.options.locale.format,!0).isValid()&&moment(a[1],e.options.locale.format,!0).isValid()}};else switch(e.validationtype){case"Phone":t.callback={message:e.validationMessage||"This field must be a valid phone number. (###-###-####)",callback:function(t,a,i){return IEversion<10?!e.required&&""===t||!(!t.match(/\d{3}-?\d{3}-?\d{4}/)||t.match(/\d{3}-?\d{3}-?\d{4}/)[0]!=t)&&(i.val(t.replace(/(\d{3})\-?(\d{3})\-?(\d{4})/,"$1-$2-$3")),!0):""===t||i.intlTelInput("isValidNumber")}};break;case"Email":t.emailAddress={message:e.validationMessage||"The value is not a valid email address"};break;case"URL":t.uri={message:e.validationMessage||"The value is not a valid URL (http://xx.xx or https://xx.xx)."};break;case"PostalCode":t.regexp={regexp:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z] ?[0-9][A-Z][0-9]$/i,message:e.validationMessage||"This field must be a valid postal code"}}return{validators:$.extend(t,e.validators||{})}},cot_form.prototype.addfieldvalidation=function(e,t,a){var i=this.validatorOptions(t);this.addValidatorMessageDiv(t,i,a,t.grid),e.fields[t.id]=i},cot_form.prototype.addValidatorMessageDiv=function(e,t,a,i){if(!$.isEmptyObject(t.validators)){var r=a.appendChild(document.createElement("div"));r.id="fv_err_msg_"+Math.random().toString().split(".")[1]+"_"+(i||""),r.className="fv-err-msg",this.updateDescribedBy(a,r.id),t.err="#"+r.id}},cot_form.prototype.updateDescribedBy=function(e,t){var a=$(e).find("input,textarea,select"),i=a.attr("aria-describedby")?a.attr("aria-describedby").split(" "):[];a.attr("aria-describedby",i.concat([t]).join(" "))},cot_form.prototype.callFunction=function(e){return e.apply(this,Array.prototype.slice.call(arguments,1))},cot_form.prototype.staticFieldRender=function(e,t){var a=document.createElement("p");return a.name=e.grid?"row[0]."+e.id:e.id,a.textContent=e.value,a},cot_form.prototype.htmlFieldRender=function(e,t){var a=document.createElement("div");return a.name=e.grid?"row[0]."+e.id:e.id,a.innerHTML=e.html,a},cot_form.prototype.textFieldRender=function(e,t,a){var i=t.appendChild(document.createElement("div"));i.className="entryField";var r=i.appendChild(document.createElement("input"));return e.htmlAttr&&$(r).attr(e.htmlAttr),r.title=e.title,r.type=a||"text",r.value=e.value?e.value:"",r.disabled=!!e.disabled&&"disabled",e.grid?(r.name="row["+e.grid+"]."+e.id,$(r).attr("aria-labelledby","row_sr_label_"+e.grid+" "+e.gridlabel)):(r.name=e.id,r.id=e.id),e.required?(r.setAttribute("aria-required","true"),r.className="form-control required"):r.className="form-control","Phone"==e.validationtype&&(r.className+=" phonevalidation "),r.placeholder=e.placeholder?e.placeholder:"",i},cot_form.prototype.passwordFieldRender=function(e,t){return this.textFieldRender(e,t,"password")},cot_form.prototype.radioFieldRender=function(e){var t=document.createElement("fieldset");t.className="form-control";var a=t.appendChild(document.createElement("legend"));return a.className="sr-only",a.textContent="Select an option for "+(e.title||e.id),$.each(e.choices,function(a,i){var r=t.appendChild(document.createElement("label"));r.className=e.orientation?e.orientation:"vertical",r.className+=" entryField radioLabel";var n=r.appendChild(document.createElement("input"));e.grid?n.name="row["+e.grid+"]."+e.id:(n.name=e.id,n.id=e.id+"_"+a),e.required&&n.setAttribute("aria-required","true"),n.type="radio",n.className=e.required?"required":"",n.value=i.hasOwnProperty("value")?i.value:i.text,n.disabled=!!e.disabled&&"disabled",e.value&&(n.checked=e.value==n.value?"checked":""),r.appendChild(document.createElement("span")).innerHTML=i.text}),t},cot_form.prototype.checkboxFieldRender=function(e){var t=document.createElement("fieldset");t.className="form-control";var a=t.appendChild(document.createElement("legend"));return a.className="sr-only",a.textContent="Select options for "+(e.title||e.id),$.each(e.choices,function(a,i){var r=t.appendChild(document.createElement("label"));r.className=e.orientation?e.orientation:"vertical",r.className+=" entryField checkboxLabel";var n=r.appendChild(document.createElement("input"));e.grid?n.name="row["+e.grid+"]."+e.id:(n.name=e.id,n.id=e.id+"_"+a),e.required&&n.setAttribute("aria-required","true"),n.type="checkbox",n.className=e.required?"required":"",n.value=i.hasOwnProperty("value")?i.value:i.text,n.disabled=!!e.disabled&&"disabled",i.selected&&(n.checked="checked"),r.appendChild(document.createElement("span")).innerHTML=i.text}),t},cot_form.prototype.dropdownFieldRender=function(e){var t=document.createElement("div");t.className="entryField dropdown-entry-field";var a=t.appendChild(document.createElement("select"));return e.required&&a.setAttribute("aria-required","true"),e.grid?(a.name="row["+e.grid+"]."+e.id,$(a).attr("aria-labelledby","row_sr_label_"+e.grid+" "+e.gridlabel)):(a.name=e.id,a.id=e.id),a.className="form-control",$.each(e.choices,function(t,i){var r=a.appendChild(document.createElement("option"));r.value=i.hasOwnProperty("value")?i.value:i.text,r.text=i.text,e.value&&(r.selected=e.value==r.value?"selected":"")}),a.disabled=!!e.disabled&&"disabled",t},cot_form.prototype.multiselectFieldRender=function(e){var t=document.createElement("div");t.className="entryField";var a=t.appendChild(document.createElement("select"));return e.required&&a.setAttribute("aria-required","true"),e.grid?(a.name="row["+e.grid+"]."+e.id,$(a).attr("aria-labelledby","row_sr_label_"+e.grid+" "+e.gridlabel)):(a.name=e.id,a.id=e.id),a.style.display="none",a.setAttribute("aria-hidden",!0),a.className="form-control multiselect "+e.id,a.multiple=e.multiple?"multiple":"",$.each(e.choices,function(e,t){var i=a.appendChild(document.createElement("option"));i.value=t.hasOwnProperty("value")?t.value:t.text,i.text=t.text}),a.disabled=!!e.disabled&&"disabled",t},cot_form.prototype.daterangepickerFieldRender=function(e){var t=document.createElement("div");t.className="entryField";var a=t.appendChild(document.createElement("input"));return e.grid?(a.name="row["+e.grid+"]."+e.id,$(a).attr("aria-labelledby","row_sr_label_"+e.grid+" "+e.gridlabel)):(a.name=e.id,a.id=e.id),a.type="text",a.value=e.value?e.value:"",a.className=e.required?"form-control required daterangevalidation":"form-control daterangevalidation",e.required&&a.setAttribute("aria-required","true"),a.disabled=!!e.disabled&&"disabled",t},cot_form.prototype.datetimepickerFieldRender=function(e){var t=document.createElement("div");t.className="input-group date entryField datetimepicker "+e.id,t.setAttribute("data-refid",e.id);var a=t.appendChild(document.createElement("input"));a.type="text",e.required?(a.setAttribute("aria-required","true"),a.className="form-control required"):a.className="form-control",a.value=e.value||"",e.grid?(a.name="row["+e.grid+"]."+e.id,$(a).attr("aria-labelledby","row_sr_label_"+e.grid+" "+e.gridlabel)):(a.name=e.id,a.id=e.id),a.className="form-control";var i=t.appendChild(document.createElement("span"));return i.className="input-group-addon",i.setAttribute("aria-hidden",!0),i=i.appendChild(document.createElement("span")),i.className="glyphicon "+(e.glyphicon||"glyphicon-calendar"),a.disabled=!!e.disabled&&"disabled",t},cot_form.prototype.textareaFieldRender=function(e){var t=document.createElement("div");t.className="entryField";var a=t.appendChild(document.createElement("textarea"));return e.htmlAttr&&$(a).attr(e.htmlAttr),e.grid?(a.name="row["+e.grid+"]."+e.id,$(a).attr("aria-labelledby","row_sr_label_"+e.grid+" "+e.gridlabel)):(a.name=e.id,a.id=e.id),e.cols&&(a.cols=e.cols),e.rows&&(a.rows=e.rows),a.title=e.title,a.type="text",a.className+=e.required?"form-control required":"form-control",e.required&&a.setAttribute("aria-required","true"),a.placeholder=e.placeholder?e.placeholder:"",a.value=e.value?e.value:"",a.disabled=!!e.disabled&&"disabled",t},cot_form.prototype.buttonFieldRender=function(e){var t=document.createElement("button");t.type="button",e.className&&!e.btnClass?t.className=e.className:t.className="btn btn-"+(e.btnClass||"success");var a=t.appendChild(document.createElement("span"));return a.className=e.glyphicon?"glyphicon "+e.glyphicon:"",a=t.appendChild(document.createElement("span")),a.textContent=e.title,t.disabled=!!e.disabled&&"disabled",$(t).on("click",e.onclick||function(){}),t},CotForm.prototype.render=function(e){if(this._isRendered)throw new Error("This form is already rendered");"string"==typeof e&&(e={target:e}),this.cotForm.render(e),this._isRendered=!0,this._useBinding&&(this._model&&this._fillFromModel(),this._watchChanges())},CotForm.prototype.setModel=function(e){if(e&&"function"!=typeof e.get)throw new Error("Model must be a CotModel object");this._model=e,this._fillFromModel()},CotForm.prototype._fillFromModel=function(){var e=this;this._isRendered&&(this._definition.sections||[]).forEach(function(t){(t.rows||[]).forEach(function(t){(t.fields||[]).forEach(function(t){if(t.bindTo){var a=e._model?e._model.get(t.bindTo)||"":"";switch(t.type){case"radio":case"checkbox":$.makeArray(a).forEach(function(e){var a=$('input[name="'+t.id+'"][value="'+e+'"]');a.length&&(a[0].checked=!0)});break;case"multiselect":$("#"+t.id).multiselect("select",$.makeArray(a));break;default:$("#"+t.id).val(a)}}})})})},CotForm.prototype._watchChanges=function(){var e=this;this._isRendered&&(this._definition.sections||[]).forEach(function(t){(t.rows||[]).forEach(function(t){(t.fields||[]).forEach(function(t){t.bindTo&&("radio"==t.type?$('input[name="'+t.id+'"]').on("click",function(a){e._model&&e._model.set(t.bindTo,$(a.currentTarget).val())}):"checkbox"==t.type?$('input[name="'+t.id+'"]').on("click",function(a){if(e._model){var i=$(a.currentTarget).val(),r=$.makeArray(e._model.get(t.bindTo)||[]).slice(),n=r.indexOf(i);a.currentTarget.checked&&n==-1?r.push(i):!a.currentTarget.checked&&n>-1&&r.splice(n,1),e._model.set(t.bindTo,r)}}):$("#"+t.id).on("change",function(a){if(e._model){var i=$(a.currentTarget).val();"multiselect"===t.type&&t.multiple&&!i&&(i=[]),e._model.set(t.bindTo,i)}}))})})})},CotForm.prototype.getData=function(){var e={},t={};return $.each($("#"+this.cotForm.id).serializeArray(),function(a,i){if(i.name.indexOf("row[")!==-1){var r=i.name.substring(i.name.indexOf("[")+1,i.name.indexOf("]"));if("template"!==r){var n=e.rows||[],d=t[r];void 0===d&&(n.push({}),d=n.length-1,t[r]=d),n[d][i.name.split(".")[1]]=i.value,e.rows=n}}else e.hasOwnProperty(i.name)?(e[i.name]=$.makeArray(e[i.name]),e[i.name].push(i.value)):e[i.name]=i.value}),e};